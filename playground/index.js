!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).index={})}(this,function(e){"use strict";var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function d(i,a,s,c){return new(s=s||Promise)(function(e,t){function n(e){try{o(c.next(e))}catch(e){t(e)}}function r(e){try{o(c.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}o((c=c.apply(i,a||[])).next())})}function p(n,r){var o,i,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],i=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}var r,o,i,l=(r=console.log,o=['font-family: "Microsoft YaHei", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";',"color:white;","font-size:12px;","maring:5px 0;","background:yellowgreen;"],i=["color:black;","font-size:12px;"],function(e,t){r.call(r,"%c "+e+" %c "+t,o.join(""),i.join(""))});function h(){return{pageWidth:document.body.clientWidth,pageHeight:document.body.clientHeight,screenWidth:window.screen.width,screenHeight:window.screen.height}}function v(a){["error","warn"].forEach(function(e){var i=console[e];console[e]=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=s({message:e},t),o=Object.assign(a.data(),{timeStamp:(new Date).toString(),mainType:"CONSOLE",data:r,pageInfo:h(),currentUrl:window.location.href,refererUrl:document.referrer});return a.dataQuene.add("add","error",o),i.call.apply(i,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}([i,e],t))}})}function w(e){this.userId=e.userId,this.trackId=e.trackId,this.timeStamp=e.timeStamp,this.mainType=e.mainType,this.device=e.device,this.currentUrl=e.currentUrl,this.refererUrl=e.refererUrl,this.pageInfo=e.pageInfo,this.appVersion=e.appVersion,this.apiVersion=e.apiVersion,this.appId=e.appId}var a,t,u,m=(x.prototype.DBResolve=function(){var n=this;return new Promise(function(e,t){n.DBRequest.addEventListener("success",function(){e(n.DBRequest.result)})})},x.prototype.add=function(t,n,o){return d(this,void 0,void 0,function(){var r;return p(this,function(e){return r=t.transaction([n],"readwrite").objectStore(n).add(o),[2,new Promise(function(t,n){r.addEventListener("success",function(e){t(e)}),r.addEventListener("error",function(e){n(e)})})]})})},x.prototype.read=function(t,n){return d(this,void 0,void 0,function(){var r,o;return p(this,function(e){return r=[],o=t.transaction([n]).objectStore(n),[2,new Promise(function(n,t){o.openCursor().addEventListener("success",function(e){var t=e.target.result;t?(r.push(t.value),t.continue()):n(r)}),o.openCursor().addEventListener("error",function(e){t(e)})})]})})},x.prototype.clear=function(n,r){return d(this,void 0,void 0,function(){var t;return p(this,function(e){return t=n.transaction([r],"readwrite").objectStore(r),[2,new Promise(function(e){e(t.clear())})]})})},x),f=(n(t=function(e){var t=a.call(this,e)||this;return t.data=e.data,t},u=a=w),t.prototype=null===u?Object.create(u):(O.prototype=u.prototype,new O),b.prototype.remove=function(e){localStorage.removeItem(e)},b.prototype.set=function(e,t){localStorage.setItem(e,t)},b.prototype.get=function(e){return localStorage.getItem(e)},b),g=(y.prototype.sentMessageToWorker=function(r){return d(this,void 0,void 0,function(){var n;return p(this,function(e){return n=this,[2,new Promise(function(e,t){n.worker.postMessage(JSON.stringify(r)),e(!0)})]})})},y.prototype.acceptMessageFromWorker=function(){return d(this,void 0,void 0,function(){var r;return p(this,function(e){return r=this,[2,new Promise(function(t,n){r.worker.addEventListener("message",function(e){t(e.data)}),r.worker.addEventListener("messageerror",function(e){n(e.data)})})]})})},y.prototype.add=function(e,t){this.sentMessageToWorker({type:e,data:t})},y.prototype.read=function(e,t){this.sentMessageToWorker({type:e,data:t})},y.prototype.clear=function(e,t){this.sentMessageToWorker({type:e,data:t})},y);function y(){this.worker=new Worker("../worker.js"),this.store=new f}function b(){}function O(){this.constructor=t}function x(e,t){void 0===t&&(t=1);var n=this;this.DBRequest=indexedDB.open(e,t),this.transactionList=[],this.DBRequest.onerror=function(){},this.DBRequest.onsuccess=function(){n.transactionList.forEach(function(e){return e(n.DBRequest.result)})},this.DBRequest.onupgradeneeded=function(e){var t=e.target.result;t.objectStoreNames.contains("error")||t.createObjectStore("error",{keyPath:"errorId",autoIncrement:!0})}}var S=(k.prototype.add=function(e,t,n){var r=this.dataOperator.get(e);this.dataQuene.push(r("indexDB",{type:e,tableName:t,data:n})),this.run()},k.prototype.run=function(){return d(this,void 0,void 0,function(){var t;return p(this,function(e){switch(e.label){case 0:return[4,this.db.DBResolve()];case 1:return t=e.sent(),this.dataQuene.length&&(this.dataQuene.shift()(t),this.run()),[2]}})})},k);function k(){this.worker=new g,this.db=new m("monitor"),this.dataQuene=[],this.dataOperator=new Map,this.dataOperator.set("add",this.worker.add),this.dataOperator.set("read",this.worker.read),this.dataOperator.set("clear",this.worker.clear)}function E(e){var t=new m("monitor"),n=new S;!function(){d(this,void 0,void 0,function(){var t,n,r;return p(this,function(e){switch(e.label){case 0:return t=new g,n=t.store.get("LastVisited"),t.sentMessageToWorker({type:"store",data:{LastVisited:n}}),[4,t.acceptMessageFromWorker()];case 1:return r=e.sent().LastVisited,t.store.set("LastVisited",r),[2]}})})}();var r,o,i,a,s,c,u=new w({userId:"1345854620",trackId:(c=Date.now().toString(36),c+=Math.random().toString(36).substr(3)),device:{os:function(){var e=navigator.userAgent,t="Win32"==navigator.platform||"Windows"==navigator.platform,n="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;if(n)return"Mac";if("X11"==navigator.platform&&!t&&!n)return"Unix";if(-1<String(navigator.platform).indexOf("Linux"))return"Linux";if(t){if(-1<e.indexOf("Windows NT 5.0")||-1<e.indexOf("Windows 2000"))return"Win2000";if(-1<e.indexOf("Windows NT 5.1")||-1<e.indexOf("Windows XP"))return"WinXP";if(-1<e.indexOf("Windows NT 5.2")||-1<e.indexOf("Windows 2003"))return"Win2003";if(-1<e.indexOf("Windows NT 6.0")||-1<e.indexOf("Windows Vista"))return"WinVista";if(-1<e.indexOf("Windows NT 6.1")||-1<e.indexOf("Windows 7"))return"Win7";if(-1<e.indexOf("Windows NT 10")||-1<e.indexOf("Windows 10"))return"Win10"}return"other"}(),browser:(i=[(r="undefined"!=typeof window&&window.navigator.userAgent.toLowerCase())&&/msie|trident/.test(r),o=r&&0<r.indexOf("edge/"),r&&/chrome\/\d+/.test(r)&&!o,r&&(-1<r.indexOf("opera")||-1<r.indexOf("opr")),r&&-1<r.indexOf("safari")&&-1===r.indexOf("chrome"),r&&0<r.indexOf("mqqbrowser"),r&&-1<r.indexOf("firefox"),r&&0<r.indexOf("ucbrowser/"),r&&0<r.indexOf("baiduboxapp"),r&&0<r.indexOf("android"),r&&/iphone|ipad|ipod|ios/.test(r)],(a=["IE","Edge","Chrome","Opera","Safari","QQ","FF","UC","Baidu","Android","IOS"].map(function(e){return{type:e,ua:r}}))[s=i.map(function(e,t){if(e)return t}).filter(Boolean)[0]]?a[s]:{type:"unknow",ua:r})},appVersion:1,apiVersion:1,appId:1}),f={db:t,data:function(){return function e(t,n){if(void 0===n&&(n=new Map),"object"==typeof t){if(n.has(t))return n.get(t);var r=Array.isArray(t)?[]:{};for(var o in n.set(t,r),t)r[o]="object"==typeof t[o]?e(t[o],n):t[o];return r}}(u)},request:function(e,t){var n,r;r="http://test.xiangyou.ouj.com:5000"+t+"/abc.jpg?",function t(n){Object.keys(n).forEach(function(e){"[object Object]"===Object.prototype.toString.call(n[e])?t(n[e]):r+=e+"="+n[e]+"&"})}(e),n=r=r.substring(r.lastIndexOf("&"),-1),new Image(1,1).src=n},dataQuene:n};[function(o){return d(this,void 0,void 0,function(){var n;return p(this,function(e){return n=window.addEventListener,window.addEventListener=function(e,r,t){return n.call(this,e,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return r.apply(this,e)}catch(e){var n=Object.assign(o.data(),{timeStamp:(new Date).toString(),mainType:"EVENTLISTENER",data:e,pageInfo:h(),currentUrl:window.location.href,refererUrl:document.referrer,eventType:e.name});o.dataQuene.add("add","error",n)}},t)},[2]})})},v,function(d){window.addEventListener("error",function(e){var t;if(e.cancelable){var n=e.lineno,r=e.filename,o=e.timeStamp,i=e.error;t={lineno:n,filename:r,timeStamp:o,message:i?i.message:e.message,stack:i?i.stack:""}}else{var a=e.target,s=a.localName,c=a.href,u=a.src;t={resourceType:s,sourceUrl:"link"===s?c:u}}var f=Object.assign(d.data(),{timeStamp:(new Date).toString(),mainType:t.resourceType?"RESOURCE":"ERROR",data:t,pageInfo:h(),currentUrl:window.location.href,refererUrl:document.referrer});d.request(f,"/error")},!0)},function(e){["click","input"].forEach(function(e){window.addEventListener(e,function(e){console.log(e)})},!0)},function(r){window.addEventListener("unhandledrejection",function(e){var t={reason:e.reason,timeStamp:e.timeStamp},n=Object.assign(r.data(),{timeStamp:(new Date).toString(),mainType:"PROMISE",data:t,pageInfo:h(),currentUrl:window.location.href,refererUrl:document.referrer});throw console.log(n),r.request(n,"/error"),new Error("Test Promised")})},function(e){},function(e){}].forEach(function(e){e(f)}),l("[ MonitorSDK ]","Starting Monitor")}E(),e.initMonitor=E,Object.defineProperty(e,"__esModule",{value:!0})});
